<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Asistente del Hogar</title>

<!-- PWA Meta Tags -->
<meta name="description" content="OrganizÃ¡ las tareas del hogar, recetas y jornadas de trabajo">
<meta name="theme-color" content="#F5F2ED">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Casa">
<meta name="mobile-web-app-capable" content="yes">

<!-- PWA Icons -->
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%23F5F2ED'/><text y='125' x='18' font-size='110'>ğŸ </text></svg>">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>ğŸ </text></svg>">
<link rel="manifest" href="manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="css/styles.css">

<style>@keyframes spin { to { transform: rotate(360deg); } }</style>
</head>
<body>

<!-- LOADING OVERLAY -->
<div id="loading-overlay" style="display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;gap:16px">
  <div style="font-size:2.5rem">ğŸ </div>
  <div style="font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--gold)" id="loading-msg">Conectando...</div>
  <div style="width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite"></div>
</div>

<!-- AUTH UI -->
<div id="auth-overlay" style="display:none;position:fixed;inset:0;background:var(--bg);z-index:9998;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:24px">
  <div style="font-size:3rem">ğŸ </div>
  <div style="font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--text)">Asistente del Hogar</div>
  <div style="font-size:14px;color:var(--muted);text-align:center">IniciÃ¡ sesiÃ³n para acceder a tu lista</div>
  <button onclick="signInWithGoogle()" style="display:flex;align-items:center;gap:12px;background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:14px 28px;font-family:'Lato',sans-serif;font-size:15px;font-weight:700;color:var(--text);cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08);transition:box-shadow 0.2s" onmouseover="this.style.boxShadow='0 4px 16px rgba(0,0,0,0.14)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'">
    <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.14 0 5.95 1.08 8.17 2.85l6.09-6.09C34.46 3.04 29.51 1 24 1 14.82 1 7.07 6.48 3.7 14.18l7.1 5.52C12.5 13.72 17.8 9.5 24 9.5z"/><path fill="#4285F4" d="M46.52 24.5c0-1.64-.15-3.22-.42-4.75H24v9h12.67c-.55 2.96-2.2 5.47-4.67 7.16l7.19 5.59C43.52 37.53 46.52 31.44 46.52 24.5z"/><path fill="#FBBC05" d="M10.8 28.3A14.54 14.54 0 0 1 9.5 24c0-1.49.26-2.93.7-4.3l-7.1-5.52A23.93 23.93 0 0 0 0 24c0 3.86.92 7.51 2.55 10.74l8.25-6.44z"/><path fill="#34A853" d="M24 47c5.51 0 10.14-1.82 13.52-4.96l-7.19-5.59c-1.82 1.22-4.15 1.95-6.33 1.95-6.2 0-11.5-4.22-13.2-9.9l-8.25 6.44C7.07 41.52 14.82 47 24 47z"/></svg>
    Continuar con Google
  </button>
</div>

<nav>
  <div class="nav-brand" id="nav-brand">ğŸ  Casa</div>
  <div class="nav-tabs">
    <button class="nav-tab lunes-tab active" onclick="showView('lunes')">Lunes</button>
    <button class="nav-tab miercoles-tab" onclick="showView('miercoles')">MiÃ©rcoles</button>
    <button class="nav-tab viernes-tab" onclick="showView('viernes')">Viernes</button>
    <button class="nav-tab" onclick="showView('menu')">MenÃº</button>
    <button class="nav-tab" onclick="showView('compras')">ğŸ›’ Compras</button>
    <button class="nav-tab" onclick="showView('plan')">ğŸ“… Plan semana</button>
    <button class="nav-tab admin-only" onclick="showView('historial')">Historial</button>
  </div>
  <!-- ROLE SELECTION -->
<div id="role-selection-overlay" style="display:none;position:fixed;inset:0;background:var(--bg);z-index:9997;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:24px">
  <div style="font-size:2.5rem">ğŸ‘‹</div>
  <div style="font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--text);text-align:center">Â¿Con quÃ© rol vas a usar la app?</div>
  <div style="font-size:14px;color:var(--muted);text-align:center;max-width:320px">ElegÃ­ tu rol. El Admin puede editar tareas, recetas y ver el historial.</div>
  <div style="display:flex;flex-direction:column;gap:12px;width:100%;max-width:320px">
    <button onclick="window._confirmRole('admin')" style="padding:16px;border-radius:12px;border:2px solid var(--gold);background:rgba(212,168,71,0.08);font-family:'Lato',sans-serif;font-size:15px;font-weight:700;color:var(--gold);cursor:pointer">ğŸ‘‘ Admin â€” control total</button>
    <button onclick="window._confirmRole('user')" style="padding:16px;border-radius:12px;border:2px solid var(--border);background:var(--surface);font-family:'Lato',sans-serif;font-size:15px;font-weight:700;color:var(--text);cursor:pointer">ğŸ‘¤ Usuario â€” uso diario</button>
  </div>
</div>
</nav>

<main>

  <!-- ===== LUNES ===== -->
  <div id="view-lunes" class="view active">
    <div id="notif-lunes"></div>
    <div id="clock-lunes" class="clock-widget" style="display:none">
      <div class="clock-info">
        <div class="clock-label">Tiempo trabajado hoy</div>
        <div class="clock-time" id="elapsed-lunes">00:00:00</div>
        <div class="clock-remaining" id="remaining-lunes">Tiempo restante: <span>â€”</span></div>
      </div>
      <div class="clock-actions">
        <div class="session-elapsed" id="session-label-lunes"></div>
        <button class="btn btn-danger" onclick="endSession('lunes')">Finalizar jornada</button>
      </div>
    </div>
    <div class="reset-bar">
      <div class="day-title">Lunes <em class="lunes-color">Â·</em> Tareas</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" onclick="startSession('lunes')" id="start-btn-lunes">â–¶ Iniciar jornada</button>
        <button class="btn btn-ghost" onclick="resetDay('lunes')">â†º Resetear dÃ­a</button>
      </div>
    </div>
    <div id="progress-lunes"></div>
    <div id="tasks-lunes"></div>
    <div class="day-notes">
      <div class="day-notes-title">ğŸ“ Notas del dÃ­a</div>
      <div id="notes-list-lunes"></div>
      <div class="note-input-row">
        <input class="note-input" id="note-input-lunes" placeholder="Dejar una nota para el equipo..." onkeydown="if(event.key==='Enter')addNote('lunes')" />
        <button class="btn btn-primary" onclick="addNote('lunes')">Enviar</button>
      </div>
    </div>
  </div>

  <!-- ===== MIÃ‰RCOLES ===== -->
  <div id="view-miercoles" class="view">
    <div id="notif-miercoles"></div>
    <div id="clock-miercoles" class="clock-widget" style="display:none">
      <div class="clock-info">
        <div class="clock-label">Tiempo trabajado hoy</div>
        <div class="clock-time" id="elapsed-miercoles">00:00:00</div>
        <div class="clock-remaining" id="remaining-miercoles">Tiempo restante: <span>â€”</span></div>
      </div>
      <div class="clock-actions">
        <div class="session-elapsed" id="session-label-miercoles"></div>
        <button class="btn btn-danger" onclick="endSession('miercoles')">Finalizar jornada</button>
      </div>
    </div>
    <div class="reset-bar">
      <div class="day-title">MiÃ©rcoles <em class="miercoles-color">Â·</em> Tareas</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" onclick="startSession('miercoles')" id="start-btn-miercoles">â–¶ Iniciar jornada</button>
        <button class="btn btn-ghost" onclick="resetDay('miercoles')">â†º Resetear dÃ­a</button>
      </div>
    </div>
    <div id="progress-miercoles"></div>
    <div id="tasks-miercoles"></div>
    <div class="day-notes">
      <div class="day-notes-title">ğŸ“ Notas del dÃ­a</div>
      <div id="notes-list-miercoles"></div>
      <div class="note-input-row">
        <input class="note-input" id="note-input-miercoles" placeholder="Dejar una nota para el equipo..." onkeydown="if(event.key==='Enter')addNote('miercoles')" />
        <button class="btn btn-primary" onclick="addNote('miercoles')">Enviar</button>
      </div>
    </div>
  </div>

  <!-- ===== VIERNES ===== -->
  <div id="view-viernes" class="view">
    <div id="notif-viernes"></div>
    <div id="clock-viernes" class="clock-widget" style="display:none">
      <div class="clock-info">
        <div class="clock-label">Tiempo trabajado hoy</div>
        <div class="clock-time" id="elapsed-viernes">00:00:00</div>
        <div class="clock-remaining" id="remaining-viernes">Tiempo restante: <span>â€”</span></div>
      </div>
      <div class="clock-actions">
        <div class="session-elapsed" id="session-label-viernes"></div>
        <button class="btn btn-danger" onclick="endSession('viernes')">Finalizar jornada</button>
      </div>
    </div>
    <div class="reset-bar">
      <div class="day-title">Viernes <em class="viernes-color">Â·</em> Tareas</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" onclick="startSession('viernes')" id="start-btn-viernes">â–¶ Iniciar jornada</button>
        <button class="btn btn-ghost" onclick="resetDay('viernes')">â†º Resetear dÃ­a</button>
      </div>
    </div>
    <div id="progress-viernes"></div>
    <div id="tasks-viernes"></div>
    <div class="day-notes">
      <div class="day-notes-title">ğŸ“ Notas del dÃ­a</div>
      <div id="notes-list-viernes"></div>
      <div class="note-input-row">
        <input class="note-input" id="note-input-viernes" placeholder="Dejar una nota para el equipo..." onkeydown="if(event.key==='Enter')addNote('viernes')" />
        <button class="btn btn-primary" onclick="addNote('viernes')">Enviar</button>
      </div>
    </div>
  </div>

  <!-- ===== MENÃš ===== -->
  <div id="view-menu" class="view">
    <div id="menu-list-view">
      <div class="reset-bar" style="margin-bottom:16px">
        <div class="day-title">MenÃº <em style="color:var(--gold)">Â·</em> Recetas <span id="season-badge" style="font-family:'Lato',sans-serif;font-size:13px;font-weight:700;padding:4px 12px;border-radius:999px;margin-left:8px;vertical-align:middle"></span></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-ghost" onclick="getAIRecommendations()" id="ai-rec-btn">âœ¨ Sugerir con IA</button>
          <button class="btn btn-primary" onclick="openAddRecipeModal()">+ Agregar receta</button>
        </div>
      </div>
      <div id="ai-rec-result"></div>
      <input class="menu-search" type="text" placeholder="Buscar receta..." oninput="filterRecipes(this.value)" />
      <div class="menu-filter-row">
        <button class="filter-chip active" onclick="setFilter('todos', this)">Todos</button>
        <button class="filter-chip" onclick="setFilter('mealprep', this)">Meal prep</button>
        <button class="filter-chip" onclick="setFilter('rapido', this)">RÃ¡pido</button>
        <button class="filter-chip" onclick="setFilter('finde', this)">Fin de semana</button>
        <button class="filter-chip" onclick="setFilter('singluten', this)">Sin gluten</button>
        <button class="filter-chip" onclick="setFilter('calor', this)">ğŸŒ Verano</button>
        <button class="filter-chip" onclick="setFilter('frio', this)">ğŸ§¥ Invierno</button>
        <button class="filter-chip" onclick="setFilter('fresco', this)">ğŸƒ Todo el aÃ±o</button>
      </div>
      <div id="today-rec" style="margin-bottom:20px"></div>
      <div class="recipes-grid" id="recipes-grid"></div>
    </div>
    <div id="menu-detail-view" class="recipe-detail">
      <button class="back-btn" onclick="closeRecipeDetail()">â† Volver al menÃº</button>
      <div id="recipe-detail-content"></div>
    </div>
  </div>

  <!-- ===== COMPRAS ===== -->
  <div id="view-compras" class="view">
    <div class="reset-bar" style="margin-bottom:12px">
      <div class="day-title">ğŸ›’ Lista de Compras</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" onclick="clearCheckedItems()">Limpiar tachados</button>
        <button class="btn btn-ghost" style="color:var(--danger);border-color:var(--danger)" onclick="clearShoppingList()">Borrar lista</button>
      </div>
    </div>
    <div id="shopping-source" style="font-size:13px;color:var(--muted);margin-bottom:16px"></div>
    <div id="shopping-list-container"></div>
  </div>

  <!-- ===== PLAN SEMANA ===== -->
  <div id="view-plan" class="view">
    <div class="reset-bar" style="margin-bottom:8px">
      <div class="day-title">ğŸ“… Plan de la semana</div>
      <button class="btn btn-primary" onclick="savePlan()">Guardar y generar lista</button>
    </div>
    <p style="color:var(--muted);font-size:13px;margin-bottom:24px">ElegÃ­ hasta 3 recetas para cocinar esta semana. La lista de compras se genera automÃ¡ticamente.</p>
    <div id="plan-selections"></div>
    <div id="plan-recipe-picker" style="margin-top:24px"></div>
  </div>

  <!-- ===== HISTORIAL ===== -->
  <div id="view-historial" class="view">
    <div class="reset-bar" style="margin-bottom:24px">
      <div class="day-title">Historial <em style="color:var(--gold)">Â·</em> Jornadas</div>
      <button class="btn btn-ghost" onclick="clearHistory()" style="color:var(--danger)">Borrar todo</button>
    </div>
    <div id="history-overview-stats"></div>
    <div id="history-entries"></div>
  </div>

</main>

<!-- ADD RECIPE MODAL -->
<div class="modal-overlay" id="add-recipe-modal">
  <div class="modal">
    <div class="modal-title">Nueva receta</div>
    <div class="form-group">
      <label class="form-label">Nombre</label>
      <input class="form-input" id="r-name" placeholder="Ej: Pollo al horno con papas" />
    </div>
    <div class="form-group">
      <label class="form-label">Emoji</label>
      <input class="form-input" id="r-emoji" placeholder="ğŸ—" style="width:80px" />
    </div>
    <div class="form-group">
      <label class="form-label">Tiempo de preparaciÃ³n (minutos)</label>
      <input class="form-input" id="r-time" type="number" placeholder="60" />
    </div>
    <div class="form-group">
      <label class="form-label">CategorÃ­as</label>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer"><input type="checkbox" id="r-mealprep"> Meal prep</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer"><input type="checkbox" id="r-rapido"> RÃ¡pido</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer"><input type="checkbox" id="r-finde"> Fin de semana</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer"><input type="checkbox" id="r-sg" checked> Sin gluten</label>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Ingredientes (uno por lÃ­nea, ej: Pollo 1kg)</label>
      <textarea class="form-textarea" id="r-ingredients" placeholder="Pollo 1kg&#10;Papas 500g&#10;Aceite de oliva 3 cdas"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">Pasos (uno por lÃ­nea)</label>
      <textarea class="form-textarea" id="r-steps" placeholder="Precalentar el horno a 200Â°C&#10;Condimentar el pollo..."></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">ConservaciÃ³n</label>
      <input class="form-input" id="r-storage" placeholder="Ej: Hasta 4 dÃ­as en heladera en recipiente hermÃ©tico" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeAddRecipeModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="saveNewRecipe()">Guardar receta</button>
    </div>
    <input type="hidden" id="r-edit-id" value="" />
  </div>
</div>

<script type="module" src="/src/main.js"></script>

</body>
</html>
